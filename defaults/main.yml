---
# 任务参数 #
os_config: false # 是否执行主机初始配置。
os_datadisc: false # 是否挂载数据盘。
os_exporter: false # 是否部署普罗米修斯客户端。
os_harden: false # 是否执行主机加固配置。
os_ossec: false # 是否部署入侵检测客户端。
os_software: false # 是否执行主机基本软件安装和更新。

# 通用参数 #
os_audit: false # 是否启用主机审计。
os_disable_ipv6: false # 是否关闭IPv6。
os_pass_length: '12' # 账户最低密码长度。
os_pass_maxAge: '60' # Windows主机账户密码有效期。
#os_proxy_server: 'http://1.1.1.1:3142' # 主机代理服务器。
#os_update_password: 'changeme' # 修改新部署Linux主机管理账户密码。

# 公共领事参数 #
environments: 'SIT' # 定义系统环境。
consul_public_register: false # 是否向公共领事注册普罗米修斯终端。
consul_public_exporter_token: '00000000-0000-0000-0000-000000000000' # 公共领事客户端访问控制令牌。
consul_public_http_port: '8500' # 公共领事公共客户端端口。
consul_public_clients: # 公共领事公共客户端列表。
  - '127.0.0.1'

# 远程日志参数 #
syslog: false # 是否启用远程日志。
syslog_port: '12201' # 远程日志服务器端口。
syslog_protocol: 'udp' # 远程日志服务器协议。
syslog_server: # 远程日志服务器地址列表。
  - '127.0.0.1'

# 入侵检测系统参数 #
ossec_version: '3.9.2'
ossec_authd_pass: 'Bf6vJRT4WaEAHq'
ossec_managers:
  - address: '127.0.0.1'
    port: '1514'
    protocol: 'udp'
    api_port: '55000'
    api_proto: 'https'
    api_user: null
ossec_profile: null
ossec_auto_restart: 'yes'
ossec_agent_authd:
  enable: true
  port: '1515'
  ssl_auto_negotiate: 'no'
ossec_notify_time: '10'
ossec_time_reconnect: '60'
ossec_crypto_method: 'aes'
ossec_winagent_config:
  install_dir: 'C:\Program Files\ossec-agent\'
  install_dir_x86: 'C:\Program Files (x86)\ossec-agent\'
  auth_path: C:\'Program Files'\ossec-agent\agent-auth.exe
  auth_path_x86: C:\'Program Files (x86)'\ossec-agent\agent-auth.exe
  version: '3.9.2'
  revision: '1'
  repo: https://packages.ossec.com/3.x/windows/
  md5: 43936e7bc7eb51bd186f47dac4a6f477
ossec_agent_config:
  active_response:
    ar_disabled: 'no'
    ca_store: '/var/ossec/etc/wpk_root.pem'
    ca_store_win: 'wpk_root.pem'
    ca_verification: 'yes'
  log_format: 'plain'
  client_buffer:
    disable: 'no'
    queue_size: '5000'
    events_per_sec: '500'
  syscheck:
    frequency: 43200
    scan_on_start: 'yes'
    auto_ignore: 'no'
    alert_new_files: 'yes'
    remove_old_diff: 'yes'
    restart_audit: 'yes'
    win_audit_interval: 300
    skip_nfs: 'yes'
    ignore:
      - /etc/mtab
      - /etc/hosts.deny
      - /etc/mail/statistics
      - /etc/random-seed
      - /etc/random.seed
      - /etc/adjtime
      - /etc/httpd/logs
      - /etc/utmpx
      - /etc/wtmpx
      - /etc/cups/certs
      - /etc/dumpdates
      - /etc/svc/volatile
      - /sys/kernel/security
      - /sys/kernel/debug
    ignore_win:
      - '.log$|.htm$|.jpg$|.png$|.chm$|.pnf$|.evtx$'
    no_diff:
      - /etc/ssl/private.key
    directories:
      - dirs: /etc,/usr/bin,/usr/sbin
        checks: 'check_all="yes"'
      - dirs: /bin,/sbin
        checks: 'check_all="yes"'
    win_directories:
      - dirs: '%WINDIR%\regedit.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\system.ini'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\win.ini'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\at.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\attrib.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\cacls.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\cmd.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\drivers\etc'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\eventcreate.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\ftp.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\lsass.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\net.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\net1.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\netsh.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\reg.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\regedt32.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\regsvr32.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\runas.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\sc.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\schtasks.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\sethc.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\subst.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\wbem\WMIC.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\WindowsPowerShell\v1.0\powershell.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\SysNative\winrm.vbs'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\at.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\attrib.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\cacls.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\cmd.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\drivers\etc'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\eventcreate.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\ftp.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\net.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\net1.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\netsh.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\reg.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\regedit.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\regedt32.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\regsvr32.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\runas.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\sc.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\schtasks.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\sethc.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\subst.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\wbem\WMIC.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\WindowsPowerShell\v1.0\powershell.exe'
        checks: 'check_all="yes"'
      - dirs: '%WINDIR%\System32\winrm.vbs'
        checks: 'check_all="yes"'
      - dirs: '%PROGRAMDATA%\Microsoft\Windows\Start Menu\Programs\Startup'
        checks: 'check_all="yes" realtime="yes"'
    windows_registry:
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\batfile'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\cmdfile'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\comfile'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\exefile'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\piffile'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\AllFilesystemObjects'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\Directory'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\Folder'
      - key: 'HKEY_LOCAL_MACHINE\Software\Classes\Protocols'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Policies'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Security'
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Internet Explorer'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services'
      - key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\KnownDLLs'
      - key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurePipeServers\winreg'
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx'
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\URL'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon'
        arch: "both"
      - key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Active Setup\Installed Components'
        arch: "both"
    windows_registry_ignore:
      - key: 'HKEY_LOCAL_MACHINE\Security\Policy\Secrets'
      - key: 'HKEY_LOCAL_MACHINE\Security\SAM\Domains\Account\Users'
      - key: '\Enum$'
        type: "sregex"
  rootcheck:
    frequency: 43200
  openscap:
    disable: 'no'
    timeout: 1800
    interval: '1d'
    scan_on_start: 'yes'
  osquery:
    disable: 'no'
    run_daemon: 'yes'
    bin_path_win: 'C:\ProgramData\osquery\osqueryd'
    log_path: '/var/log/osquery/osqueryd.results.log'
    log_path_win: 'C:\ProgramData\osquery\log\osqueryd.results.log'
    config_path: '/etc/osquery/osquery.conf'
    config_path_win: 'C:\ProgramData\osquery\osquery.conf'
    add_labels: 'yes'
  syscollector:
    disable: 'no'
    interval: '1h'
    scan_on_start: 'yes'
    hardware: 'yes'
    os: 'yes'
    network: 'yes'
    packages: 'yes'
    ports_no: 'yes'
    processes: 'yes'
  vuls:
    disable: 'yes'
    interval: '1d'
    run_on_start: 'yes'
    args:
      - 'mincvss 5'
      - 'antiquity-limit 20'
      - 'updatenvd'
      - 'nvd-year 2016'
      - 'autoupdate'
  localfiles:
    debian:
      - format: 'syslog'
        location: '/var/log/auth.log'
      - format: 'syslog'
        location: '/var/log/syslog'
      - format: 'syslog'
        location: '/var/log/dpkg.log'
      - format: 'syslog'
        location: '/var/log/kern.log'
    centos:
      - format: 'syslog'
        location: '/var/log/messages'
      - format: 'syslog'
        location: '/var/log/secure'
      - format: 'syslog'
        location: '/var/log/maillog'
      - format: 'audit'
        location: '/var/log/audit/audit.log'
    linux:
      - format: 'syslog'
        location: '/var/ossec/logs/active-responses.log'
      - format: 'command'
        command: df -P -x squashfs -x tmpfs -x devtmpfs
        frequency: '360'
      - format: 'full_command'
        command: ss -nutal | awk '{print $1,$5,$6;}' | sort -b | column -t
        alias: 'netstat listening ports'
        frequency: '360'
      - format: 'full_command'
        command: 'last -n 20'
        frequency: '360'
    windows:
      - format: 'eventlog'
        location: 'Application'
      - format: 'eventchannel'
        location: 'Security'
        query: 'Event/System[EventID != 5145 and EventID != 5156 and EventID != 5447 and EventID != 4656 and EventID != 4658 and EventID != 4663 and EventID != 4660 and EventID != 4670 and EventID != 4690 and EventID != 4703 and EventID != 4907]'
      - format: 'eventlog'
        location: 'System'
      - format: 'syslog'
        location: 'active-response\active-responses.log'
  labels:
    enable: true
    list:
      - key: 'Environments'
        value: 'Production'

# Linux 数据盘参数 #
os_linux_disc_device: '/dev/sdb' # 数据盘块设备。
os_linux_fsopts: 'defaults,noatime,nobarrier' # 数据盘挂载参数。
os_linux_fstype: 'xfs' # 数据盘文件系统。
os_linux_lv: 'lv_data' # 逻辑卷名称。
os_linux_lv_size: '100%FREE' # 逻辑卷容量。
os_linux_mount_point: '/data' # 逻辑卷挂载点。
os_linux_vg: 'VolGroup01' # 逻辑卷卷组名称。

# Linux 系统参数 #
os_linux_disable_fs_exec_flags: 'rw,nosuid,nodev,noexec,relatime' # 磁盘分区安全挂载参数。
os_linux_disable_fs_home_exec: false # /home 挂载点分区是否启用安全挂载参数。
os_linux_disable_fs_shm_exec: true # /dev/shm 挂载点分区是否启用安全挂载参数。
os_linux_disable_fs_tmp_exec: false # /tmp 挂载点分区是否启用安全挂载参数。
os_linux_disable_fs_vartmp_exec: false # /var/tmp 挂载点分区是否启用安全挂载参数。
os_linux_disable_tcp_offloading: true # 是否禁用TCP卸载。
os_linux_disable_RootLogin: true # 是否禁用root登录。
os_linux_disable_selinux: true # 是否禁用selinux。
os_linux_disable_sysstat_collect: true # 是否禁用sysstat监测。
os_linux_disable_unused_module: true # 是否禁用不需要的模块。
os_linux_disable_unused_service: true # 是否禁用不需要的服务。
os_linux_enables_needed_service: true # 是否启用需要的服务。
#os_linux_grub_add_args: # GRUB新增参数。
#  - 'ipv6.disable={% if os_disable_ipv6 %}1{% else %}0{% endif %}'
#  - 'transparent_hugepage=never'
#  - 'numa=off'
#os_linux_id_rsa: 'MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIUcZI4Qk5H60d0gD5zXhOYqmX67N5Qb8q1SdsQckg4b22rcdrZHftc2YPN166WEWWKyviVPG4yk0VEOWdc9l5cCAwEAAQ==' # 主机SSH密钥。
#os_linux_MTA_relayhost: '1.1.1.1' # 邮件中继服务器地址。
os_linux_syslog_local_keep: '2' # 本地日志保留期(周)。
os_linux_tz: 'Asia/Shanghai' # 主机时区。
os_linux_ulimit_nofile: '20480' # 会话打开的文件/文件描述符的最大数目。
os_linux_ulimit_nproc: '20480' # 会话打开的系统进程的最大数目。
os_linux_user_pw: # 密码复杂度策略。
  minlen: '{{ os_pass_length | default(12) }}'
  dcredit: '-1'
  ucredit: '-1'
  lcredit: '-1'

# Windows 系统参数 #
os_win_disable_allowindexingencryptedstoresoritems: false # 是否禁止对项目建立索引。
os_win_disable_allowyouraccount: false # 是否禁止用户更改帐户设置。
os_win_disable_autodownload: false # 是否禁止自动下载更新。
os_win_disable_autorun: false # 是否禁止自动播放。
os_win_disable_autoupdate: false # 是否禁止自动更新。
os_win_disable_hidefileext: false # 是否隐藏已知文件类型的扩展名。
os_win_disable_osupgrade: false # 是否禁止系统升级。
os_win_disable_rss: false # 是否禁用接收端缩放。
os_win_disable_task: # 需要关闭的系统任务调度程序。
  - 'ScheduledDefrag'
  - 'ServerManager'
os_win_event_log: # 需要配置的系统事件日志。
  - 'Application'
  - 'Security'
  - 'Setup'
  - 'System'
os_win_event_log_MaxSize: '4096' # 本地系统事件日志的最大容量(KB)。
os_win_format: 'en-US' # 主机语言格式
os_win_fs_audit_rule: # 文件系统审计规则。
  - 'AppendData'
  - 'CreateDirectories'
  - 'CreateFiles'
  - 'Delete'
  - 'DeleteSubdirectoriesAndFiles'
  - 'WriteData'
os_win_fs_audit_user: 'Everyone' # 文件系统审计账户名。
os_win_gpo_audit_policy: # 组审计策略。
  - 'Account Logon'
  - 'Logon/Logoff'
  - 'Account Management'
  - 'DS Access'
  - 'Object Access'
  - 'Policy change'
  - 'Privilege use'
os_win_location: '45' # 主机地理位置。https://docs.microsoft.com/en-us/windows/desktop/Intl/table-of-geographical-locations
os_win_network_location: 'Private' # 网络位置。Private / Public
os_win_pagefile_size: 4096 # 虚拟内存页面文件容量(MB)。
os_win_roles: # 需要安装的系统组件。
  - 'Telnet-Client'
os_win_software: # 需要安装的第三方软件。
  - 'googlechrome'
  - 'notepadplusplus.install'
  - 'nxlog'
  - 'peazip.install'
os_win_tz: 'China Standard Time' # 主机时区。
os_win_unicode: 'zh-CN' # 主机字符集编码。
os_win_update_category: ['CriticalUpdates', 'SecurityUpdates'] # 需要更新的类别列表。

# Windows 普罗米修斯客户端参数 #
wmi_exporter_collector: # 普罗米修斯客户端收集器。
  - 'ad'
  - 'cpu'
  - 'cs'
  - 'dns'
  - 'iis'
  - 'logical_disk'
#  - 'mssql'
  - 'net'
  - 'os'
  - 'service'
  - 'system'
  - 'tcp'
  - 'textfile'
#  - hyperv
#  - msmq
#  - process
#  - vmware
wmi_exporter_extra_collector: '--collector.service.services-where="Name=''nxlog''"'

# Linux 普罗米修斯客户端参数 #
node_exporter_port: '9100' # 普罗米修斯客户端端口。
node_exporter_collector: # 普罗米修斯客户端系统收集器。
  - 'arp'
  - 'bcache'
  - 'conntrack'
  - 'cpu'
  - 'entropy'
  - 'filefd'
  - 'hwmon'
  - 'infiniband'
  - 'ipvs'
  - 'loadavg'
  - 'meminfo'
  - 'netdev'
  - 'netstat'
  - 'nfs'
  - 'ntp'
  - 'sockstat'
  - 'stat'
  - 'time'
  - 'uname'
  - 'vmstat'
  - 'timex'
#  - mdadm
#  - bonding
#  - wifi
#  - xfs # kernel 4.4+
#  - zfs
#  - buddyinfo
#  - drbd
#  - interrupts
#  - ksmd
#  - logind
#  - meminfo_numa
#  - mountstats
#  - qdisc
#  - runit
#  - supervisord
  - 'systemd'
#  - tcpstat
  - 'textfile'
node_exporter_systemd_collector: # 普罗米修斯客户端服务收集器。
  - 'sshd'
  - 'auditd'
  - 'rsyslog'
  - 'crond'
  - 'ntpd'
node_exporter_ignored_mount_points_collector: # 普罗米修斯客户端收集器忽略的磁盘挂载点。
  - 'data/docker/'
  - 'dev'
  - 'proc'
  - 'rootfs'
  - 'rpc_pipefs'
  - 'run'
  - 'run/docker/netns/'
  - 'sys'
node_exporter_ignored_devices_collector: # 普罗米修斯客户端收集器忽略的块设备。
  - 'ram'
  - 'loop'
  - 'fd'
  - 'sr'
